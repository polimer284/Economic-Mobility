---
title: "RedWine Data Analysis"
subtitle : "Multiple Regression Analysis"
author: "Kyung Yoon Lee"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Introduction of wine-quality data : 


![Red Wine, Portugal vinho verde locator](http://www.vidigalwines.com/portal/eng/wp-content/uploads/2015/08/map-pt2017.png)

```
Input variables (based on physicochemical tests):
   1 - fixed acidity
   2 - volatile acidity
   3 - citric acid
   4 - residual sugar
   5 - chlorides
   6 - free sulfur dioxide
   7 - total sulfur dioxide
   8 - density
   9 - pH
   10 - sulphates
   11 - alcohol
   Output variable (based on sensory data): 
   12 - quality (score between 0 and 10)
   
Missing Attribute Values: None
```

```{r message=FALSE, warning=FALSE, paged.print=TRUE}
library("ggplot2")
library("corrplot")
library('leaps')
```



```{r}
setwd("D:\\R")

Whitewine <- read.table('winequality-white.csv', header = T, sep = ';', stringsAsFactors = F)
str(Whitewine)
```
.



This project was conducted by using Rstudio. I had to readdress my working direction to where my winequality-white.csv file is located in. Afterward, I read the data file by using read.table function and had a brief look whether if the data was imported appropriately. I was able to find that data set was including 'quality' as a variable. Thus, I decided to look over this data by making my focus on 'what defines wine quality.'


.
```{r, fig.width=5, fig.height=5.0}
ggplot(data = Whitewine, aes(x = quality)) + 
  geom_bar(width = 1, color = 'black', fill = 'blue', na.rm = T)  + 
  ggtitle("Wine Quliaty distribution")
```

.

First of all, i decided to have a look on wine quality distribution. By making this plot, i was able to see that most of the wines are rated between 5 ~ 7 implying that there are not much outliers we have to consider. 

(Later on in this report, I am going to use Multiple Regression Analysis although wine quality is categorical variable since it has an order and every quality level has a meaning.)

Before moving directly into analysis, I decided to take a look of correlation coefficient between variables 

.

```{r}
corrplot(cor(Whitewine))
```

.

According to this table, it seems that alcohol has positive linear correlation with quality. However, although alcohol has correlation with quality, we cannot impulsively conclude that alcohol explains wine quality since correlation just simple implies that it has linear relationship. The concept between 'X explains Y' and 'X has relationship with Y' is totally different. There are bunch of examples that although X has relationship with Y, still X cannot explain Y.

As a result, i had to use Multiple Regression Analysis in order to find out what determines wine quality.

For now on, I would like to look over this data with Multiple Regression Analysis. I have set Wine$quality as Y, and other attribute values as X, which will be used to explain wine quality as each variables change.

.


```{r}
linearmodel <- lm(quality~., data = Whitewine)
summary(linearmodel)
```

.

I have used lm(quality ~ .) formula to make basic linearmodel which i am going to use in further analysis. To have a brief look over this data, i have used summary function to check standard deviation and t-value. Since summary contains coefficient information, I can see that several atttribute values may be omitted in final Multiple Regression Analysis model. However, before continuing the process, i had to check wheter if we can use Multiple Regression Analysis within this data since this model is based on several assumptions.


1. Normality : Multiple regression assumes that the residuals are normally distributed.

2. No Multicollinearity : Multiple regression assumes that the independent variables are not highly correlated with each other.

3. Homoscedasticity : The variance of error terms are similar across the values of the independent variables.

4. Independence : varaible should be independent within each other.


Before deciding Multiple Regression model in data anlysis, i had to check whether the assumptions mentioned above is acceptable.

.

```{r}
plot(rstudent(linearmodel))
```

.

In order to use Mutiple Regression Analysis, we have to look over standardized resuduals distribution. By taking a look over this value, we can know wheter our assumptions used in Multiple Regression Analysis are acceptable. To do so, i have made a plot with rstudent(linearmodel). By looking over this data, i was able to figure out 

1. Residuals are almost equally distributed from Y = 0

2. Most of the residuals are within range of +-2 <- It means that there is not much outliers which might weeken our analysis.

In conclusion, this plot shows enough evidence that we can continue with our Multiple Regression Analysis.

From now on, i would like to go back to our assumptions of Multiple Regression model and check each of them.

.

```{r}
par(mfrow=c(2,2))
plot(linearmodel)
par(mfrow=c(1,1))  # to display 4 graphs in 1 display
```

.

Frist of all, by looking the plot in left top, we can check Linearity. If we want to say the data-set follows linearity, there should be no relathionship between residuals and expected values except random noise. The reason why it looks as if it has a pattern is because 'wine quality' is categorical variable not a discrete variable. In order to solve this problem, i can use jitter function to add some noise and make them as discrete variable. However, since data will be disordered from its original shape, I am not going to use this option but rather continue my process with categorical variable. (Check out last page of this report if you want to look this plot with jitter option.)

Secondly, if we look at the Q-Q plot located in right top, we can see that most of the data is located on the line. Thus, i can conclude that it follows Normality assumption.

Thirdly, to check homoscedasticity, we can look at the plot located in left bottom. The data should be distributed as random band by horizontal line. As well as the first plot, this plot seems as if it has a pattern since wine quality is categorical variable. (It is normal for plot to be in this kind of shape when Y is defined as categorical variable.)

Lastly, the plot located in right bottom is to check outliers and high leverage point. We can conclude there is no outliers or high leverage point that we must take care of.

In conclusion, i am certain that we can use Multiple Regression Analysis since the data-set does not have any outliers or high levereage point and follows normality. This means that within the ragne of data i have currently, attribute values can be used to explain wine quality.


As a result, I decided to use Multiple Regression model in explaining wine quality by using step function.

.

```{r}
step(linearmodel, direction = "backward")
```

.

Backward regression is used when we want to put all of the attribute variables in the linear model in the first place. By eliminating each of the variables which has weak connection in explaing Y, it is able to find which linear model best explains wine quality. 

If we look the information produced above, we can see that it first strated with AIC value 2788. It contained all of the attribute variables to explain wine quality. However, as i have mentioned in the beginning of this analysis, there are several attribute variables that we can omit in final linear model. We can see what attribute variables are omitted as process goes on.

In the final model, i was able to find out that citric.acid, chlordies, total.sulfur.dioxide were deleted. Although we have deleted 3 of the attribute values from the first lenear model, AIC value is now 2793, which only have incresed by 5 points from the beginning. (These deleted variables can be expected in the first place when we used summary function. P-value of these attributes were not small enough to have some meaning.)

.

```{r}
afterlinearmodel <- lm(formula = quality ~ fixed.acidity + volatile.acidity + residual.sugar + 
    free.sulfur.dioxide + density + pH + sulphates + alcohol, 
    data = Whitewine)
```

.

I have allocated the new linear model with fewer attribute values as 'afterlinearmodel.' I am going to check out whether this linear model explaines what defines wine quality. To do so, i have used anova table.

.

```{r}
anova(afterlinearmodel, linearmodel)
```

.

In this anova table, since P-value is found as 0.8481, i was able to conclude that this Multiple Rgression model explains this data-set well. Thus i was able to conclude that what defines wine quality is Fixed.acidity, volatile.aciditiy, residual.sugar, free.sulfur.dioxide, density, pH, supphates and alcohol.

.


```{r}
summary(afterlinearmodel)
```

.

If we take a look on the summary with fitted linear model, the adjusted R-squared value is 0.28. This means that this linear model explains 28% of what defines wine quality. This might seem very low poportion to explain certain factor. However, if we consider that this was Multiple Regression analysis with several attribute values, i believe that 28% is enough to conclude that it provides valueable information in what defines wine quality.

(Acceptable R value can differ between fields. For example, social scince field accepts very low R value because of its studies characteristics. Since we do not have certain criteria in wine industry in this data-set regarding what R value to accept or not, I decided to accept this model by considering that it is hard to get high value of Adjusted R-squared value in Multiple Regression Analysis.)

.


## +a Jittered wine qulity plot


```{r}
par(mfrow=c(2,2))
plot(lm(jitter(Whitewine$quality, factor = 2.5)~., data = Whitewine))
```

I have added 2.5 facotr in adding some noise on quality variable and made them as discrete variable. Within plots explaining residuals, we can now see there are no patterns.


https://rstudio-pubs-static.s3.amazonaws.com/190997_40fa09db8e344b19b14a687ea5de914b.html - 다중회귀모형
http://arkainoh.blogspot.com/2017/05/multiple.regression.analysis.html - 다중회귀모형

.